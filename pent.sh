#!/bin/bash
# Created by Eldruin
# Last update 2021-02-23
#
# This script scans a network with several tools and generates a report with the result of each one.
# The report model covers the basic stages of a pentest.
# As far as possible new tools will be added to the script ...
tools="nmap,dirb,ffuf,enum4linux,nbtscan"
# dirb is only needed because of his wordlist in /usr/share/wordlists/dirb/common.txt
declare -i test=0
declare -i col=$(echo "$1" | sed 's/\./ /g' | awk '{print NF}')
echo

if [[ $(whoami) != 'root' || $# -ne 1 || $col -ne 3 && $col -ne 4 ]]
then
	echo -e "This script need to:\n 1) Be executed as ROOT\n 2) Receive the NETWORK or TARGET HOST as parameter\n"
	echo -e "Examples: "
	echo -e "\t Network ---> sudo ./pent.sh 10.11.1"
	echo -e "\t Host\t ---> sudo ./pent.sh 10.11.1.1"
else
	for tool in $(echo -e $tools | sed 's/,/\n/g')
	do
		if [[ $(dpkg -l $tool 2>/dev/null) = "" ]]
		then
			test=1
			echo "The tool: >>> $tool <<< need to be installed!!!"
		fi
	done
	if [[ $test -eq 1 ]]
	then
		echo -e "\nInstall the required tool(s) and re-run the script...\n\n"
	else
		resume="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Resume @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n"
		recon="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Recon/Enum @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n"
		tech="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Tech @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n"
		exploit="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Exploit @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n"
		post="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Post Exploit @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n"
		x="\n----------X----------X----------X----------X----------X----------X------\n"
		for ip in $(seq 1 255)
		do
			if [[ $col == 4 ]]
			then
				echo -e "\n >>>>> HOST SCAN STARTED <<<<<"	
				host=$1
				ip=255
			else
				if [[ $ip == 0 ]]
				then
					echo -e "\n >>>>> NETWORK SCAN STARTED <<<<<"
				fi
				host=$1.$ip
			fi
			echo -e " Scanning $host "
			file="./notes-$host-$(date '+%Y.%m.%d').ml"
			rm $file 2>/dev/null
			touch $file
			echo -e $resume >> $file
			echo -e $recon >> $file
			
			echo $host
			echo "Nmap -sS -sC -sV -p- -Pn $host" >> $file
			nmap -sS -sC -sV -p- -Pn $host >> $file
			echo -e $x >> $file
			
			echo "Ffuf -w /usr/share/wordlists/dirb/common.txt -u http://$host/FUZZ -maxtime-job 60 -recursion -recursion-depth 5 -v | grep '| URL |'" >> $file
			ffuf -w /usr/share/wordlists/dirb/common.txt -u http://$host/FUZZ -recursion -recursion-depth 5 -v | grep "| URL | " > .tmp
			cat .tmp | grep -v "[INFO]" | cut -d " " -f4 >> $file
			rm .tmp
			echo -e $x >> $file
			
			echo "Enum4linux $host" >> $file
			enum4linux $$host >> $file
			echo -e $x >> $file
			
			echo "Nbtscan $host" >> $file
			nbtscan $host >> $file
			echo -e $x >> $file
		
			echo -e $tech >> $file
			echo -e $exploit >> $file
			echo -e $post >> $file

			chmod 666 $file

			#check if was passed a network or host, if it was a host it break the for loop
			if [[ $col == 4 ]]
			then
				break
			fi
		done
		echo -e "\n --- FINISHED ---"
	fi
fi
