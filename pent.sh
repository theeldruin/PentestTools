#!/bin/bash
# Created by Eldruin
# Last update 2021-02-24
#
# This script scans a network with several tools and generates a report with the result of each one.
# The report model covers the basic stages of a pentest.
# As far as possible new tools will be added to the script ...
tools="nmap,dirb,ffuf,enum4linux,nbtscan"
# dirb is only needed because of his wordlist in /usr/share/wordlists/dirb/common.txt
declare -i test=0
echo

if [[ $(whoami) != 'root' || $# -ne 1 || $(echo "$1" | sed 's/\./ /g' | awk '{print NF}') -ne 3 || test -eq 1 ]]
then
	echo -e "This script need to:\n 1) Be executed as ROOT\n2) Receive the network as parameter\n\n"
	echo -e "Example: sudo ./pent.sh 10.11.1"
else
	for tool in $(echo -e $tools | sed 's/,/\n/g')
	do
		if [[ $(dpkg -l $tool 2>/dev/null) = "" ]]
		then
			test=1
			echo "The tool: >>> $tool <<< need to be installed!!!"
		fi
	done
	if [[ $test -eq 1 ]]
	then
		echo -e "\nInstall the required tool(s) and re-run the script...\n\n"
	else
		net=$1
		resume="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Resume @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n"
		recon="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Recon/Enum @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n"
		tech="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Tech @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n"
		exploit="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Exploit @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n"
		post="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Post Exploit @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n"
		x="\n----------X----------X----------X----------X----------X----------X------\n"
		for ip in $(seq 1 255)
		do
			file="./notes-$net.$ip-$(date '+%Y.%m.%d').ml"
			rm $file 2>/dev/null
			touch $file
			echo -e $resume >> $file
			echo -e $recon >> $file
			
			echo "Nmap -sS -sC -sV -p- -Pn $net.$ip" >> $file
			nmap -sS -sC -sV -p- -Pn $net.$ip >> $file
			echo -e $x >> $file
			
			echo "Ffuf -w /usr/share/wordlists/dirb/common.txt -u http://$net.$ip/FUZZ -maxtime-job 60 -recursion -recursion-depth 5 -v | grep '| URL |'" >> $file
			ffuf -w /usr/share/wordlists/dirb/common.txt -u http://$net.$ip/FUZZ -maxtime-job 60 -recursion -recursion-depth 5 -v | grep "| URL | " > .tmp
			cat .tmp | grep -v "[INFO]" | cut -d " " -f4 >> $file
			rm .tmp
			echo -e $x >> $file
			
			echo "Enum4linux $net.$ip" >> $file
			enum4linux $net.$ip >> $file
			echo -e $x >> $file
			
			echo "Nbtscan $net.$ip" >> $file
			nbtscan $net.$ip >> $file
			echo -e $x >> $file
		
			echo -e $tech >> $file
			echo -e $exploit >> $file
			echo -e $post >> $file

			chmod 777 $file
		done
	fi
fi
