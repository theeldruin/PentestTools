#!/bin/bash

declare alvo=""
declare arquivo=""

while [[ $# -gt 0 ]]; do
  case $1 in
    -t|--target)
      alvo=$2
      shift # past argument
      shift # past value
      ;;
    -T|--targets)
      arquivo=$2
      alvo=$2
      shift # past argument
      shift # past value
      ;;
    -*|--*)
      echo "Parametro Desconhecido $1"
      exit 1
      ;;
    *)
      POSITIONAL_ARGS+=("$1") # save positional arg
      shift # past argument
      ;;
esac
done

TUTORIAL() {
	echo "Este script irá fazer uma identificação das tecnologias utilizadas no(s) alvo(s) utilizando o 'whatweb'"
	echo "Formas de uso"
	echo "   wweb -t alvo.com.br"
	echo "   wweb -T alvos.txt"
	echo
}

RECON() {
	echo "Enumerando ---> $alvo"
	if [ $# -gt 0 ]; then
	    echo $alvo | whatweb -i /dev/stdin -a 3 --no-errors >> /tmp/wweb.txt
	else
	    echo "Nenhum parâmetro foi fornecido."
	fi
}

if [[ $alvo = "" || $col -lt 2 ]]
then
	TUTORIAL
else
	rm /tmp/wweb.txt 2>/dev/null
	if [[ -z $arquivo ]]
	then
	        RECON $alvo
	else
	        for host in $(cat $arquivo)
	        do
			alvo=$host
	                RECON $alvo
	        done
	fi
	clear
	cat /tmp/wweb.txt 2>/dev/null | sort -u | sed 's/, /\n   /g' | sed 's/\] /\]\n   /g' | tee wweb.txt
fi
