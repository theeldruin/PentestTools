#!/bin/bash

#Este script recebe um arquivo com os hosts a serem varridos e testados
#Exemplo
#       fasthunt.sh TARGET HEADER XSS_HUNTER
#	fasthunt.sh testphp.vulnweb.com "X-BugHunter: Myself" "https://eumesmo.xss.ht"

rnd=$(date "+%T")
target=$1
agente=$2
xsshunter=$3

if [[ -z agente ]]
then
	agente="X-BugHunter: Myself"
fi

echo $agente
echo $xsshunter

echo "---> $target"
echo "------> Scraping"
gospider -s $target -c 5 -d 5 -H $agente --blacklist ".(jpg|jpeg|js|eot|gif|css|tif|tiff|png|ttf|woff|woff2|ico|pdf|svg|txt)" --other-source | grep -e code-200 | awk '{print $5}' | grep = >> temp-$rnd.txt
paramspider -d $target -e jpg,jpeg,js,eot,gif,css,tif,tiff,png,ttf,woff,woff2,ico,pdf,svg,txt | grep = | uro >> temp-$rnd.txt
gau $target --subs --blacklist jpg,jpeg,js,eot,gif,css,tif,tiff,png,ttf,woff,woff2,ico,pdf,svg,txt | grep = | uro >> temp-$rnd.txt
cat temp-$rnd.txt | uro | Gxss -p eldruin >> dalfox-$rnd.txt

echo "------> Testando"
echo "---------> Dalfox"

if [[ -x xsshunter ]]
then
	cat dalfox-$rnd.txt | sort --random-sort | dalfox pipe --only-poc=v -S -H $agente | notify -silent
else
	cat dalfox-$rnd.txt | sort --random-sort | dalfox pipe --only-poc=v -S -H $agente --blind $xsshunter | notify -silent
fi

echo "---------> Xsstrike"
for url in $(cat dalfox-$rnd.txt)
do
	xsstrike -u $url --headers $agente --skip --skip-dom
done

rm temp-*.txt
rm dalfox-*.txt
