#!/bin/bash

declare alvo=""
declare arquivo=""
declare local=$(pwd | sed 's/^.*\///g')
declare pasta=$(pwd)

BLACK='\033[0;30m'
REDA='\033[0;31m'
GREEN='\033[0;32m'
BO='\033[0;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
LGRAY='\033[0;37m'
DGARAY='\033[1;30m'
LRED='\033[1;31m'
LGREEN='\033[1;32m'
YELLOW='\033[1;33m'
LBLUE='\033[1;34m'
LPURPLE='\033[1;35m'
LCYAN='\033[1;36m'
WAHITE='\033[1;37m'
NC='\033[0m'

while [[ $# -gt 0 ]]; do
  case $1 in
    -t|--target)
      alvo=$2
      shift # past argument
      shift # past value
      ;;
    -T|--targets)
      arquivo=$2
	  alvo=$2
      shift # past argument
      shift # past value
      ;;
    -*|--*)
      echo "Parametro Desconhecido $1"
      exit 1
      ;;
    *)
      POSITIONAL_ARGS+=("$1") # save positional arg
      shift # past argument
      ;;
esac
done

RECON() {
	#--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	echo -e "${NC} $alvo"


	echo -e "${PURPLE}---> Enumerando Subdominios"
	echo -e "------> Running Subfinder"
	echo $alvo | subfinder -silent >> /tmp/temp-$local.txt

	#echo -e "------> Running Sublist3r"
	#touch /tmp/sub.txt
	#sublist3r -d $alvo -o /tmp/sub.txt 2>/dev/null 1>/dev/null
	#cat /tmp/sub.txt >> /tmp/temp.txt

	echo -e "------> Running Gau"
	echo $alvo | gau --subs | cut -d "/" -f 1,2,3 | sed 's/?.*$//g' | cut -d ':' -f 1,2 | sort | anew >> /tmp/temp-$local.txt

        echo -e "------> Running Waybackurl"
	echo $alvo | waybackurls | cut -d "/" -f 1,2,3 | sed 's/?.*$//g' | cut -d ':' -f 1,2 | sort | anew >> /tmp/temp-$local.tx

	#echo -e "------> Running OWASP Amass"
	#amass enum -brute -silent -d $alvo >> /tmp/temp.txt

	echo -e "------> Running DNSX"
	dnsx -silent -retry 3 -cname -l amass enum -brute -silent -d $alvo >> /tmp/temp-$local.txt

	echo -e "------> Running Chaos"
	chaos -silent -d $alvo >> /tmp/temp-$local.txt

	echo -e "------> Running Assetfinder"
	echo $alvo | assetfinder --subs-only | anew >> /tmp/temp-$local.txt

	echo -e "------> Verificando crt.sh"
	curl -s "https://crt.sh/?q=%25.$alvo" | grep "$alvo" | egrep -v "&|%" | sed 's/<TD>//g' | sed 's/<\/TD>//g' | sed 's/ //g' | sed 's/\*\.//g' | sed 's/<BR>/\n/g' | sort | anew >> /tmp/temp-$local.txt

	echo
}

rm /tmp/temp-$local.txt 2>/dev/null
rm subs.txt 2>/dev/null

if [[ -z $arquivo ]]
then
	RECON $alvo
else
	for host in $(cat $arquivo)
	do
		cd $pasta
		alvo=$host
		RECON $alvo
	done
fi

### Filtrando subdominios encontrados e ativos
#echo -e "------> Verificando links que ainda estÃ£o ativos"
#cat /tmp/temp-$local.txt | tr '[:upper:]' '[:lower:]' | sort | anew | httpx -silent -retries 2 -fc 404 | anew subs.txt

cat /tmp/temp-$local.txt | tr '[:upper:]' '[:lower:]' | sed 's/http:\/\///g' | sed 's/https:\/\///g'| sed 's/*\.//g' | sed 's/^www//g' | sed 's/^\.//g' | anew | sort > subs.txt

rm /tmp/temp-$local.txt

