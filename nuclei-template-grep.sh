#!/bin/bash

atual=$(date | awk '{print $7}')

echo "Novos templates:"

for i in $(seq 2000 $atual)
do
	ano=$i

	for path in $(locate "nuclei-templates/cves" | sed "s/nuclei-templates\/cves.*$/nuclei-templates\/cves/g" | sort -u)
	do
		mkdir $path 2>/dev/null
		mkdir $path/$ano 2>/dev/null

		TF1=$(mktemp)
		TF2=$(mktemp)
		TF3=$(mktemp)

		curl -s "https://github.com/projectdiscovery/nuclei-templates/tree/main/http/cves/$ano" | tr '"' '\n' | grep "^CVE-$ano" | grep -v "," | sort -u > $TF1
		ls $path/$ano > $TF2

		diff $TF1 $TF2 | grep "<" | awk '{print $2}' > $TF3
		#cat $TF3
		xargs -a $TF3 -I@ sh -c "echo $path/@"

		for arquivo in $(cat $TF3)
		do
		        #wget "https://raw.githubusercontent.com/projectdiscovery/nuclei-templates/main/http/cves/$ano/$arquivo"
	        	curl -s "https://raw.githubusercontent.com/projectdiscovery/nuclei-templates/main/http/cves/$ano/$arquivo" > $path/$ano/$arquivo
	        	#mv $arquivo /root/nuclei-templates/cves/$ano/ 2>/dev/null
		done

		rm -rf $TF1 $TF2 $TF3 2>/dev/null
	done
done

rm -rf $TF1 $TF2 $TF3 2>/dev/null
